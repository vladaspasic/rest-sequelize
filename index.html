<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Rest-sequelize by vladaspasic</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Rest-sequelize</h1>
        <p>REST Service using Sequelize ORM</p>

        <p class="view"><a href="https://github.com/vladaspasic/rest-sequelize">View the Project on GitHub <small>vladaspasic/rest-sequelize</small></a></p>


        <ul>
          <li><a href="https://github.com/vladaspasic/rest-sequelize/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/vladaspasic/rest-sequelize/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/vladaspasic/rest-sequelize">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="rest-sequelize--" class="anchor" href="#rest-sequelize--" aria-hidden="true"><span class="octicon octicon-link"></span></a>rest-sequelize <a href="https://travis-ci.org/vladaspasic/rest-sequelize"><img src="https://img.shields.io/travis/vladaspasic/rest-sequelize.svg?branch=master" alt="Build Status"></a> <a href="https://coveralls.io/r/vladaspasic/rest-sequelize"><img src="https://img.shields.io/coveralls/vladaspasic/rest-sequelize.svg" alt="Coverage Status"></a>
</h1>

<p>Rest Sequelize library is built to provide you with a extendible REST interface that you can use.</p>

<h3>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h3>

<div class="highlight highlight-bash"><pre>npm install rest-sequelize --save</pre></div>

<h3>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h3>

<p>This library exposes you a simple Namespace Object containg all the thing you would need. Let quickly through them:</p>

<ul>
<li>RestAdapter</li>
<li>RestService</li>
<li>Resolver</li>
<li>Serializer</li>
<li>Deserializer</li>
</ul>

<p>All of these classes expose <code>create</code> and <code>extend</code> methods. It is advised that you instantiate all those classes with <code>RestAdapter.create()</code> instead <code>new RestAdapter()</code>.</p>

<p>In order to create subclasses use <code>RestAdapter.extend()</code> method. Keep in mind that if you override a method in the class, you can call its super implementation like so:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> MyService <span class="pl-k">=</span> RestService.extend({
    <span class="pl-en">init</span>: <span class="pl-k">function</span>() {
        <span class="pl-v">this</span>._super();
    }
});</pre></div>

<p>For full API docs visit ....</p>

<p>This library uses <a href="https://github.com/vladaspasic/error-globals">error-globals</a> for Error handling, as we can get the <code>statusCode</code> property for each error thrown by the library to display an appropriate HTTP status code in the response.</p>

<h4>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h4>

<p>To use this you must first create a <code>RestAdapter</code> instance, and pass a <code>sequelize</code> property to it. I will not go through how to create a Sequelize instance, you can read this <a href="http://docs.sequelizejs.com/en/latest/docs/getting-started/">here</a>.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> RestSequelize <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rest-sequelize<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> adapter <span class="pl-k">=</span> RestSequelize.RestAdapter.extend({
   sequelize<span class="pl-k">:</span> sequelize,<span class="pl-c">// your initialized sequelized instance</span>
});</pre></div>

<p>Here we have created a simple <code>RestAdapter</code> instance with a <code>DefaultResolver</code>. If you wish to use a custom <code>Resolver</code> you must create your own. But we will come to that a bit later.</p>

<p>Lets asume that you have already created an sequelize instance, and defined a <code>User</code> model. To get a full list of users, you can do something like this.</p>

<div class="highlight highlight-javascript"><pre>adapter.<span class="pl-c1">find</span>(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>).then(<span class="pl-k">function</span>(<span class="pl-smi">users</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(users);
}, <span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
    <span class="pl-c">// your error handling logic</span>
});

<span class="pl-c">// Or</span>

adapter.<span class="pl-c1">find</span>(sequelize.models.User).then(<span class="pl-k">function</span>(<span class="pl-smi">users</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(users);
}, <span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
    <span class="pl-c">// your error handling logic</span>
});</pre></div>

<p>Let us explain what is going under the hood step by step.</p>

<p>First we will try to resolve the the <code>Model</code> using the <code>modelFor</code> method in the <code>RestAdapter</code>, this method then asks the <code>Resolver</code> to find it/resolve it. Resolver then tries to see if a model with a plural name for <code>users</code> exists in the the sequelize instance. Or in the second case the Model would be returned as it is already there.</p>

<p>When a model is resolved, we are trying to find a corresponding <code>RestService</code> for <code>users</code>. In this case there is none as we are using the <code>DefaultResolver</code>
to find all modules, so a default <code>RestService</code> will be returned.</p>

<p>The <code>RestService</code> class is where all the communication with the DB occurs. The default one would be sufficent in most cases, but you can always create your own.
Here you could add your custom logic that can be run against the Sequelize ORM.</p>

<p>The service will return a model with all his associatations populated, and a count property. The adapter will create a default paging query with <code>page</code> property <code>1</code> and <code>size</code> <code>30</code> and default <code>sort</code> <code>updated_at</code> and <code>order</code> <code>DESC</code>.</p>

<p>You can page a resource like this.</p>

<div class="highlight highlight-javascript"><pre>adapter.<span class="pl-c1">find</span>(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>, {
    page<span class="pl-k">:</span> <span class="pl-c1">2</span>,
    size<span class="pl-k">:</span> <span class="pl-c1">15</span>,
    sort<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>,
    order<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>asc<span class="pl-pds">'</span></span>
}).then(<span class="pl-k">function</span>(<span class="pl-smi">users</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(users);
});</pre></div>

<p>When a <code>RestService</code> finds the models, we are returning to the <code>RestAdapter</code> which will then try to find a <code>Serializer</code> to serialize the your results to a simple JSON object ready to be flushed to the client.</p>

<p>Let us now create a new User.</p>

<div class="highlight highlight-javascript"><pre>adapter.create(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>,{
    username<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>,
    password<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>pass<span class="pl-pds">'</span></span>
}).then(<span class="pl-k">function</span>(<span class="pl-smi">user</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(user);
}, <span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
    <span class="pl-c">// your error handling logic</span>
});</pre></div>

<p>Again we will try to resolve the model, but now we are going to see if there is a matching <code>Deserializer</code> which will try to deserialize the payload from the method. Deserializer can be usefull if you have wish to add some default values or manipulate them, or some of the keys are differently defined in the Model schema and in your Rest interface.</p>

<p>Afterwards we resolve a <code>RestService</code> that will actually create the Model instance and persist in the DB. The result is the again serialized using the matching <code>Serializer</code>.</p>

<p>We have now create a new User, lets see if can find him.</p>

<div class="highlight highlight-javascript"><pre>adapter.findById(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>, <span class="pl-c1">1</span>).then(<span class="pl-k">function</span>(<span class="pl-smi">user</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(user);
});</pre></div>

<p>And update it.</p>

<div class="highlight highlight-javascript"><pre>adapter.update(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>, <span class="pl-c1">1</span>, {
    username<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>new username<span class="pl-pds">'</span></span>
}).then(<span class="pl-k">function</span>(<span class="pl-smi">user</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(user);
});

<span class="pl-c">// or</span>

adapter.update(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>, {
    id<span class="pl-k">:</span> <span class="pl-c1">1</span>,
    username<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>new username<span class="pl-pds">'</span></span>
}).then(<span class="pl-k">function</span>(<span class="pl-smi">user</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(user);
});</pre></div>

<p>Mainly the same happens here as well, resolving <code>Model</code> -&gt; <code>Deserializer</code> -&gt; <code>RestService</code> -&gt; <code>Serializer</code>. But inside the Service where are trying to see if the model with that ID exists and update it.</p>

<p>And we can delete it</p>

<div class="highlight highlight-javascript"><pre>adapter.delete(<span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>, <span class="pl-c1">1</span>).then(<span class="pl-k">function</span>(<span class="pl-smi">user</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(user);
});</pre></div>

<h4>
<a id="resolver" class="anchor" href="#resolver" aria-hidden="true"><span class="octicon octicon-link"></span></a>Resolver</h4>

<p>As you could see the <code>Resolver</code> is one powerfull tool here as we can resolve to different implementations of the <code>Service</code>, <code>Serializer</code>, <code>Deserializer</code> and <code>Model</code> depending on the <code>name</code> and <code>type</code>.</p>

<p>To create your custom resolver you must implement the <code>resolve</code> method. Where type can be <code>services</code>, <code>models</code>, <code>serializers</code> or <code>deserializers</code>. Maybe you wish to add more types to your Rest interface that could be used by the Adapter.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> RestSequelize <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>rest-sequelize<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> MyResolver <span class="pl-k">=</span> RestSequelize.Resolver.extend({
    <span class="pl-en">resolve</span>: <span class="pl-k">function</span>(<span class="pl-smi">type</span>, <span class="pl-smi">name</span>) {
        <span class="pl-c">// Your logic</span>
    }
});</pre></div>

<p>And we can now add it the <code>RestAdapter</code>. Please make sure that you do not pass a
instance as the resolver is created by the <code>RestAdapter</code> which will then pass the <code>sequelize</code> property to it.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> adapter <span class="pl-k">=</span> RestSequelize.RestAdapter.extend({
   sequelize<span class="pl-k">:</span> sequelize,
   Resolver<span class="pl-k">:</span> MyResolver
});</pre></div>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/vladaspasic">vladaspasic</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-57430955-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>